<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحة الحساب الشخصي</title>
    <link rel="stylesheet" href="../css/User Profile Page.css">
</head>
<body>
    <header class="main-header">
        <div class="container2">
            <div class="logo">
                <a href="home.html">شعار الموقع</a>
            </div>
            <nav>
                <ul class="navbar">
                    <li><a href="Home Page.html">الرئيسية</a></li>
                    <li><a href="serch.html">البحث عن حرفي</a></li>
                    <li><a href="Booking Page.html">حجز خدمة</a></li>
                    <li><a href="Reviews Page.html">التقييمات</a></li>
                    <li><a href="Support Page.html">الدعم</a></li>
                    <li><a href="Professional.html">الحساب الشخصي</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="profile-container">
        <div class="profile-header">
            <h2>حسابي الشخصي</h2>
            <a href="#" id="logout-btn" class="logout-btn">تسجيل الخروج</a>
        </div>
        <div class="profile-info">
            <h3>معلومات الحساب</h3>
            <form action="#">
                <div class="form-group">
                    <label for="username">اسم المستخدم:</label>
                    <input type="text" id="username">
                </div>
                <div class="form-group">
                    <label for="email">البريد الإلكتروني:</label>
                    <input type="email" id="email">
                </div>
                <div class="form-group">
                    <label for="phone">رقم الهاتف:</label>
                    <input type="text" id="phone">
                </div>
                <div class="form-group">
                    <label for="location">الموقع:</label>
                    <input type="text" id="location">
                </div>
            </form>
        </div>

        <div class="profile-bookings">
            <h3>الحجزات</h3>
            <ul class="booking-list" id="booking-list">
                <!-- سيتم إضافة الحجزات هنا ديناميكياً -->
            </ul>
        </div>
        
        <!-- Div to display booking details -->
        <div id="booking-details" class="popup" style="display: none;">
            <div class="popup-content">
                <span id="close-popup" onclick="closePopup()">&times;</span>
                <p id="booking-info"></p>
            </div>
        </div>        
        
    </div>
</body>

<script>
// التحقق من وجود account_id في localStorage أو sessionStorage
const account_id = localStorage.getItem('account_id') || sessionStorage.getItem('account_id');

// تحقق إذا كان account_id موجودًا
if (account_id) {
    // استدعاء البيانات من ملف الـ PHP باستخدام account_id
    fetch(`get_user_data.php?account_id=${account_id}`)
        .then(response => response.json())
        .then(data => {
            // عرض بيانات المستخدم
            document.getElementById('username').value = data.user.username;
            document.getElementById('email').value = data.user.email;
            document.getElementById('phone').value = data.user.phone;
            document.getElementById('location').value = data.user.location;

            // عرض الحجزات
            const bookingList = document.getElementById('booking-list');
            data.bookings.forEach((booking, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'booking-item';
                listItem.textContent = `الحجز رقم ${index + 1} - ${booking.date}`;
                listItem.onclick = () => showBookingDetails(booking.name, booking.service_type, booking.date, booking.time);
                bookingList.appendChild(listItem);
            });
        });
} else {
    // إذا لم يكن account_id موجودًا، قم بإعادة التوجيه إلى صفحة تسجيل الدخول
    window.location.href = '#';
}

// وظائف عرض التفاصيل وإغلاق النافذة المنبثقة
function showBookingDetails(name, profession, date, time) {
    const details = `
        <p><strong>الحجز مع:</strong> ${name}</p>
        <p><strong>المهنة:</strong> ${profession}</p>
        <p><strong>اليوم:</strong> ${date}</p>
        <p><strong>الوقت:</strong> ${time}</p>
    `;
    
    document.getElementById('booking-details').style.display = 'flex';
    document.getElementById('booking-info').innerHTML = details;
}

function closePopup() {
    document.getElementById('booking-details').style.display = 'none';
}

document.getElementById('logout-btn').addEventListener('click', function() {
    // إزالة account_id من التخزين عند تسجيل الخروج
    localStorage.removeItem('account_id');
    sessionStorage.removeItem('account_id');
    window.location.href = 'Login Page.html';
});
</script>
</html>
